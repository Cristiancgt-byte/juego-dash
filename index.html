<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Shooter con Tienda y Enemigos Nuevos</title>
  <style>
    body { margin: 0; background: #111; color: white; font-family: sans-serif; text-align: center; }
    canvas { background: #000; display: block; margin: 10px auto; border: 2px solid white; }
    #ui { margin-top: 10px; }
    button { padding: 10px 20px; margin: 5px; font-size: 16px; cursor: pointer; border-radius: 8px; border: none; }
    #shop { display:none; background:#222; padding:20px; margin:10px auto; width:80%; border-radius:10px; }
    #shop button { display:block; margin:10px auto; width:60%; }
  </style>
</head>
<body>
  <h1>Shooter con Tienda ðŸš€</h1>
  <canvas id="gameCanvas" width="600" height="400"></canvas>
  <div id="ui">
    <button id="startBtn">Comenzar</button>
    <button id="restartBtn" style="display:none;">Reiniciar</button>
    <button id="shopBtn" style="display:none;">Tienda ðŸ›’</button>
    <p id="info"></p>
  </div>
  <div id="shop">
    <h2>Tienda</h2>
    <button onclick="buy('color')">Cambiar color del jugador (50 monedas)</button>
    <button onclick="buy('vida')">Comprar vida extra (75 monedas)</button>
    <button onclick="buy('fondo')">Cambiar color de fondo (50 monedas)</button>
    <button onclick="buy('enemigo')">Cambiar color de enemigos (50 monedas)</button>
    <button onclick="buy('rafaga')">Mejorar rÃ¡faga de disparo (80 monedas)</button>
    <button onclick="buy('dobleCoins')">Mejora: x2 monedas por enemigo (100 monedas)</button>
    <button onclick="closeShop()">Cerrar</button>
  </div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let game;

// === Clases ===
class Player {
  constructor() {
    this.x = canvas.width/2;
    this.y = canvas.height-40;
    this.size = 20;
    this.speed = 5;
    this.lives = 3;
    this.shield = false;
    this.color = "lime";
  }
  draw(){
    ctx.fillStyle = this.shield ? "cyan" : this.color;
    ctx.fillRect(this.x-this.size/2, this.y-this.size/2, this.size, this.size);
  }
}

class Bullet {
  constructor(x,y,dy,color="white"){
    this.x=x; this.y=y; this.dy=dy; this.size=5; this.color=color;
  }
  update(){ this.y+=this.dy; }
  draw(){
    ctx.fillStyle=this.color;
    ctx.fillRect(this.x-this.size/2, this.y-this.size/2, this.size, this.size);
  }
}

class Enemy {
  constructor(x,y,type="square"){
    this.x=x; this.y=y; this.size=20; this.dy=1+Math.random()*1.5;
    this.type=type; // "square" o "triangle"
  }
  update(){ this.y+=this.dy; }
  draw(){
    ctx.fillStyle=game.enemyColor;
    if(this.type==="square"){
      ctx.fillRect(this.x-this.size/2, this.y-this.size/2, this.size, this.size);
    } else {
      ctx.beginPath();
      ctx.moveTo(this.x, this.y-this.size/2);
      ctx.lineTo(this.x-this.size/2, this.y+this.size/2);
      ctx.lineTo(this.x+this.size/2, this.y+this.size/2);
      ctx.closePath();
      ctx.fill();
    }
  }
}

class Pickup {
  constructor(x,y,type){
    this.x=x; this.y=y; this.type=type; this.size=15; this.dy=1;
  }
  update(){ this.y+=this.dy; }
  draw(){
    ctx.fillStyle = this.type==="rapid" ? "yellow" :
                    this.type==="shield" ? "cyan" : "orange";
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.size/2,0,Math.PI*2);
    ctx.fill();
  }
}

// === Inicializar Juego ===
function init(){
  game = {
    player: new Player(),
    bullets: [],
    enemies: [],
    pickups: [],
    score: 0,
    coins: 0,
    keys: {},
    over: false,
    lastShot: 0,
    tick: 0,
    fireDelay: 20,
    multip: 1,
    bgColor:"#000",
    enemyColor:"red",
    coinBoost:1
  };
}

function shootBullet(){
  game.bullets.push(new Bullet(game.player.x, game.player.y-15, -5));
  if(game.rafagaLevel && game.rafagaLevel>0){
    game.bullets.push(new Bullet(game.player.x-10, game.player.y-15, -5));
    game.bullets.push(new Bullet(game.player.x+10, game.player.y-15, -5));
  }
}

// === Main Update ===
function update(){
  if(game.over) return;
  game.tick++;

  // movimiento jugador
  if(game.keys["ArrowLeft"] || game.keys["a"]) game.player.x-=game.player.speed;
  if(game.keys["ArrowRight"] || game.keys["d"]) game.player.x+=game.player.speed;
  if(game.keys["ArrowUp"] || game.keys["w"]) game.player.y-=game.player.speed;
  if(game.keys["ArrowDown"] || game.keys["s"]) game.player.y+=game.player.speed;

  // limites
  game.player.x = Math.max(0, Math.min(canvas.width, game.player.x));
  game.player.y = Math.max(0, Math.min(canvas.height, game.player.y));

  // disparo
  if(game.keys["Space"] && game.tick - game.lastShot > game.fireDelay){
    shootBullet(); game.lastShot = game.tick;
  }

  // actualizar balas
  game.bullets.forEach(b=>b.update());
  game.bullets = game.bullets.filter(b=>b.y>-10);

  // spawnear enemigos
  if(game.tick%60===0){
    let type = Math.random()<0.5 ? "square" : "triangle";
    game.enemies.push(new Enemy(Math.random()*canvas.width, -20, type));
  }
  game.enemies.forEach(e=>e.update());

  // colisiones balas-enemigos
  for(let b of game.bullets){
    for(let e of game.enemies){
      if(Math.abs(b.x-e.x)<15 && Math.abs(b.y-e.y)<15){
        e.dead=true; b.dead=true;
        game.score += 10*game.multip;
        game.coins += (1*game.coinBoost);
      }
    }
  }
  game.bullets = game.bullets.filter(b=>!b.dead);
  game.enemies = game.enemies.filter(e=>!e.dead);

  // colisiones enemigo-jugador
  for(let e of game.enemies){
    if(Math.abs(e.x-game.player.x)<20 && Math.abs(e.y-game.player.y)<20){
      if(game.player.shield){
        e.dead=true;
        game.player.shield=false;
      } else {
        e.dead=true;
        game.player.lives--;
        if(game.player.lives<=0) game.over=true;
      }
    }
  }
  game.enemies = game.enemies.filter(e=>!e.dead);
}

// === Dibujo ===
function draw(){
  ctx.fillStyle=game.bgColor;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  game.player.draw();
  game.bullets.forEach(b=>b.draw());
  game.enemies.forEach(e=>e.draw());

  ctx.fillStyle="white";
  ctx.fillText("Puntos: "+game.score,10,20);
  ctx.fillText("Vidas: "+game.player.lives,10,40);
  ctx.fillText("Monedas: "+game.coins,10,60);

  if(game.over){
    ctx.fillStyle="red";
    ctx.font="30px sans-serif";
    ctx.fillText("GAME OVER", canvas.width/2-80, canvas.height/2);
  }
}

// === Loop ===
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

// === Input ===
window.addEventListener("keydown", e=>{
  game.keys[e.key]=true;
  game.keys[e.code]=true;
});
window.addEventListener("keyup", e=>{
  game.keys[e.key]=false;
  game.keys[e.code]=false;
});

// === Botones ===
document.getElementById("startBtn").onclick=()=>{
  init();
  loop();
  document.getElementById("startBtn").style.display="none";
  document.getElementById("restartBtn").style.display="inline-block";
  document.getElementById("shopBtn").style.display="inline-block";
};
document.getElementById("restartBtn").onclick=()=>{
  init();
};
document.getElementById("shopBtn").onclick=()=>{
  document.getElementById("shop").style.display="block";
};
function closeShop(){ document.getElementById("shop").style.display="none"; }

// === Compras ===
function buy(item){
  if(item==="color" && game.coins>=50){
    game.coins-=50;
    game.player.color = ["lime","blue","orange","pink","white"][Math.floor(Math.random()*5)];
  }
  if(item==="vida" && game.coins>=75){
    game.coins-=75;
    game.player.lives++;
  }
  if(item==="fondo" && game.coins>=50){
    game.coins-=50;
    game.bgColor = ["#000","#003","#030","#300","#111"][Math.floor(Math.random()*5)];
  }
  if(item==="enemigo" && game.coins>=50){
    game.coins-=50;
    game.enemyColor = ["red","purple","yellow","green","cyan"][Math.floor(Math.random()*5)];
  }
  if(item==="rafaga" && game.coins>=80){
    game.coins-=80;
    game.rafagaLevel = (game.rafagaLevel||0)+1;
  }
  if(item==="dobleCoins" && game.coins>=100){
    game.coins-=100;
    game.coinBoost=2;
  }
}
</script>
</body>
</html>
