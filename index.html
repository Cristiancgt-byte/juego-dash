<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Juego Shooter con Tienda</title>
  <style>
    body { 
      margin: 0; 
      background: #111; 
      color: white; 
      font-family: sans-serif; 
      text-align: center; 
    }
    canvas { 
      background: #000; 
      display: block; 
      margin: 10px auto; 
      border: 2px solid white; 
    }
    #ui { margin-top: 10px; }
    button { padding: 10px 20px; margin: 5px; font-size: 16px; cursor: pointer; }
    #shop {
      display: none;
      position: absolute;
      top: 50px; left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.9);
      padding: 20px;
      border: 2px solid white;
      border-radius: 10px;
    }
    #shop h2 { margin-top: 0; }
    #shop button { display: block; margin: 10px auto; }
  </style>
</head>
<body>
  <h1>Shooter con Tienda ðŸ›’</h1>
  <canvas id="gameCanvas" width="600" height="400"></canvas>
  <div id="ui">
    <button id="startBtn">Comenzar</button>
    <button id="restartBtn" style="display:none;">Reiniciar</button>
    <p>Presiona <b>T</b> para abrir la tienda</p>
  </div>

  <!-- Tienda -->
  <div id="shop">
    <h2>ðŸ›’ Tienda</h2>
    <p id="coinsText">Monedas: 0</p>
    <button onclick="buy('color')">Cambiar color jugador (10)</button>
    <button onclick="buy('life')">+1 Vida (20)</button>
    <button onclick="buy('bg')">Cambiar fondo (15)</button>
    <button onclick="buy('enemyColor')">Cambiar color enemigos (15)</button>
    <button onclick="buy('burst')">Mejorar rÃ¡faga (30)</button>
    <button onclick="closeShop()">Cerrar</button>
  </div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const shopDiv = document.getElementById("shop");
const coinsText = document.getElementById("coinsText");

let game;

// === Clases ===
class Player {
  constructor() {
    this.x = canvas.width/2;
    this.y = canvas.height-40;
    this.size = 20;
    this.speed = 5;
    this.lives = 3;
    this.shield = false;
    this.color = "lime";
    this.burst = 1; // balas simultÃ¡neas
  }
  draw(){
    ctx.fillStyle = this.shield ? "cyan" : this.color;
    ctx.fillRect(this.x-this.size/2, this.y-this.size/2, this.size, this.size);
  }
}

class Bullet {
  constructor(x,y,dy,color="white"){
    this.x=x; this.y=y; this.dy=dy; this.size=5; this.color=color;
  }
  update(){ this.y+=this.dy; }
  draw(){
    ctx.fillStyle=this.color;
    ctx.fillRect(this.x-this.size/2, this.y-this.size/2, this.size, this.size);
  }
}

class Enemy {
  constructor(x,y,color){
    this.x=x; this.y=y; this.size=20; this.dy=1+Math.random()*1.5;
    this.color=color;
  }
  update(){ this.y+=this.dy; }
  draw(){
    ctx.fillStyle=this.color;
    ctx.fillRect(this.x-this.size/2, this.y-this.size/2, this.size, this.size);
  }
}

class Pickup {
  constructor(x,y,type){
    this.x=x; this.y=y; this.type=type; this.size=15; this.dy=1;
  }
  update(){ this.y+=this.dy; }
  draw(){
    ctx.fillStyle = this.type==="rapid" ? "yellow" :
                    this.type==="shield" ? "cyan" : "orange";
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.size/2,0,Math.PI*2);
    ctx.fill();
  }
}

// === Inicializar Juego ===
function init(){
  game = {
    player: new Player(),
    bullets: [],
    enemies: [],
    pickups: [],
    score: 0,
    coins: 0,
    keys: {},
    over: false,
    lastShot: 0,
    tick: 0,
    fireDelay: 20,
    multip: 1,
    bgColor: "black",
    enemyColor: "red"
  };
  updateCoinsUI();
}

// === Disparo ===
function shootBullet(){
  const burst = game.player.burst;
  if(burst===1){
    game.bullets.push(new Bullet(game.player.x, game.player.y-15, -5));
  } else {
    for(let i=0;i<burst;i++){
      let offset = (i-(burst-1)/2)*10;
      game.bullets.push(new Bullet(game.player.x+offset, game.player.y-15, -5));
    }
  }
}

// === Main Update ===
function update(){
  if(game.over) return;
  game.tick++;

  // movimiento jugador
  if(game.keys["ArrowLeft"] || game.keys["a"]) game.player.x-=game.player.speed;
  if(game.keys["ArrowRight"] || game.keys["d"]) game.player.x+=game.player.speed;
  if(game.keys["ArrowUp"] || game.keys["w"]) game.player.y-=game.player.speed;
  if(game.keys["ArrowDown"] || game.keys["s"]) game.player.y+=game.player.speed;

  // limites
  game.player.x = Math.max(0, Math.min(canvas.width, game.player.x));
  game.player.y = Math.max(0, Math.min(canvas.height, game.player.y));

  // disparo
  if(game.keys["Space"] && game.tick - game.lastShot > game.fireDelay){
    shootBullet(); game.lastShot = game.tick;
  }

  // actualizar balas
  game.bullets.forEach(b=>b.update());
  game.bullets = game.bullets.filter(b=>b.y>-10);

  // spawnear enemigos
  if(game.tick%60===0){
    game.enemies.push(new Enemy(Math.random()*canvas.width, -20, game.enemyColor));
  }
  game.enemies.forEach(e=>e.update());

  // spawnear pickups
  if(game.tick%600===0){
    const types=["rapid","shield","double"];
    let type=types[Math.floor(Math.random()*types.length)];
    game.pickups.push(new Pickup(Math.random()*canvas.width, -20, type));
  }
  game.pickups.forEach(p=>p.update());

  // colisiones balas-enemigos
  for(let b of game.bullets){
    for(let e of game.enemies){
      if(Math.abs(b.x-e.x)<15 && Math.abs(b.y-e.y)<15){
        e.dead=true; b.dead=true;
        game.score += 10*game.multip;
        game.coins += 1; // ganar monedas
        updateCoinsUI();
      }
    }
  }
  game.bullets = game.bullets.filter(b=>!b.dead);
  game.enemies = game.enemies.filter(e=>!e.dead);

  // colisiones enemigo-jugador
  for(let e of game.enemies){
    if(Math.abs(e.x-game.player.x)<20 && Math.abs(e.y-game.player.y)<20){
      if(game.player.shield){
        e.dead=true;
        game.player.shield=false;
      } else {
        e.dead=true;
        game.player.lives--;
        if(game.player.lives<=0) game.over=true;
      }
    }
  }
  game.enemies = game.enemies.filter(e=>!e.dead);

  // colisiones pickups
  for(let p of game.pickups){
    if(Math.abs(p.x-game.player.x)<20 && Math.abs(p.y-game.player.y)<20){
      if(p.type==="rapid"){
        game.fireDelay=5;
        setTimeout(()=>game.fireDelay=20,5000);
      } else if(p.type==="shield"){
        game.player.shield=true;
      } else if(p.type==="double"){
        game.multip=2;
        setTimeout(()=>game.multip=1,5000);
      }
      p.dead=true;
    }
  }
  game.pickups = game.pickups.filter(p=>!p.dead);
}

// === Dibujo ===
function draw(){
  ctx.fillStyle=game.bgColor;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  game.player.draw();
  game.bullets.forEach(b=>b.draw());
  game.enemies.forEach(e=>e.draw());
  game.pickups.forEach(p=>p.draw());

  ctx.fillStyle="white";
  ctx.fillText("Puntos: "+game.score,10,20);
  ctx.fillText("Vidas: "+game.player.lives,10,40);
  ctx.fillText("Monedas: "+game.coins,10,60);
  if(game.player.shield) ctx.fillText("ESCUDO ACTIVO",10,80);
  if(game.multip>1) ctx.fillText("DOBLE PUNTOS!",10,100);

  if(game.over){
    ctx.fillStyle="red";
    ctx.font="30px sans-serif";
    ctx.fillText("GAME OVER", canvas.width/2-80, canvas.height/2);
  }
}

// === Loop ===
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

// === Input ===
window.addEventListener("keydown", e=>{
  game.keys[e.key]=true;
  game.keys[e.code]=true;

  if(e.key==="t" || e.key==="T") toggleShop();
});
window.addEventListener("keyup", e=>{
  game.keys[e.key]=false;
  game.keys[e.code]=false;
});

// === Tienda ===
function toggleShop(){
  if(shopDiv.style.display==="none"){
    shopDiv.style.display="block";
  } else {
    shopDiv.style.display="none";
  }
}
function closeShop(){
  shopDiv.style.display="none";
}
function updateCoinsUI(){
  coinsText.textContent = "Monedas: "+game.coins;
}
function buy(item){
  if(item==="color" && game.coins>=10){
    game.coins-=10;
    game.player.color = randomColor();
  }
  if(item==="life" && game.coins>=20){
    game.coins-=20;
    game.player.lives++;
  }
  if(item==="bg" && game.coins>=15){
    game.coins-=15;
    game.bgColor = randomColor();
  }
  if(item==="enemyColor" && game.coins>=15){
    game.coins-=15;
    game.enemyColor = randomColor();
  }
  if(item==="burst" && game.coins>=30){
    game.coins-=30;
    game.player.burst++;
  }
  updateCoinsUI();
}
function randomColor(){
  const colors=["lime","blue","orange","pink","purple","yellow","white"];
  return colors[Math.floor(Math.random()*colors.length)];
}

// === Botones ===
document.getElementById("startBtn").onclick=()=>{
  init();
  loop();
  document.getElementById("startBtn").style.display="none";
  document.getElementById("restartBtn").style.display="inline-block";
};
document.getElementById("restartBtn").onclick=()=>{
  init();
};
</script>
</body>
</html>
